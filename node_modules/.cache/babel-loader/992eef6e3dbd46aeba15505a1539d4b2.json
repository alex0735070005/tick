{"ast":null,"code":"import _objectSpread from \"/home/alex/Desktop/tick/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _defineProperty from \"/home/alex/Desktop/tick/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport feathers from 'feathers/client';\nimport rest from 'feathers-rest/client';\nimport axios from 'axios';\nimport hooks from 'feathers-hooks';\nimport auth from 'feathers-authentication-client';\nimport moment from 'moment';\nimport { API_PREFIX, HEADER_CONSTANTS } from '../constants/General';\nvar feathersClient = feathers();\nfeathersClient.configure(hooks()).configure(rest('http://localhost:9000').axios(axios)).configure(auth({\n  storage: window.localStorage\n}));\n\nfunction authHook(hook) {\n  var index = \"/\".concat(hook.path).indexOf(API_PREFIX);\n\n  if (index !== -1) {\n    feathersClient.passport.getJWT().then(function (accessToken) {\n      hook.params.headers = Object.assign({}, {\n        Authorization: accessToken\n      }, hook.params.headers);\n    });\n  }\n}\n\nvar localTimeHook = function localTimeHook(hook) {\n  hook.params.headers = Object.assign({}, _defineProperty({}, HEADER_CONSTANTS.LOCAL_TIME, moment().format('YYYY-MM-DD HH:mm')), hook.params.headers);\n};\n\nfeathersClient.mixins.push(function (service) {\n  service.before(authHook);\n  service.before(localTimeHook);\n});\nexport var getToken = function getToken() {\n  return feathersClient.passport.getJWT();\n};\nexport var addLocalTimeHeader = function addLocalTimeHeader(headers) {\n  return _objectSpread({}, headers, _defineProperty({}, HEADER_CONSTANTS.LOCAL_TIME, moment().format('YYYY-MM-DD HH:mm')));\n};\nexport default feathersClient;","map":{"version":3,"sources":["/home/alex/Desktop/tick/src/utils/FeathersClient.js"],"names":["feathers","rest","axios","hooks","auth","moment","API_PREFIX","HEADER_CONSTANTS","feathersClient","configure","storage","window","localStorage","authHook","hook","index","path","indexOf","passport","getJWT","then","accessToken","params","headers","Object","assign","Authorization","localTimeHook","LOCAL_TIME","format","mixins","push","service","before","getToken","addLocalTimeHeader"],"mappings":";;AAAA,OAAOA,QAAP,MAAqB,iBAArB;AACA,OAAOC,IAAP,MAAiB,sBAAjB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,KAAP,MAAkB,gBAAlB;AACA,OAAOC,IAAP,MAAiB,gCAAjB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SACEC,UADF,EAEEC,gBAFF,QAGO,sBAHP;AAKA,IAAMC,cAAc,GAAGR,QAAQ,EAA/B;AAEAQ,cAAc,CACbC,SADD,CACWN,KAAK,EADhB,EAECM,SAFD,CAEWR,IAAI,CAAC,uBAAD,CAAJ,CACVC,KADU,CACJA,KADI,CAFX,EAICO,SAJD,CAIWL,IAAI,CAAC;AACdM,EAAAA,OAAO,EAAEC,MAAM,CAACC;AADF,CAAD,CAJf;;AAQA,SAASC,QAAT,CAAkBC,IAAlB,EAAwB;AACtB,MAAIC,KAAK,GAAG,WAAKD,IAAI,CAACE,IAAV,EAAkBC,OAAlB,CAA0BX,UAA1B,CAAZ;;AACA,MAAIS,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChBP,IAAAA,cAAc,CAACU,QAAf,CAAwBC,MAAxB,GACCC,IADD,CACM,UAACC,WAAD,EAAiB;AACrBP,MAAAA,IAAI,CAACQ,MAAL,CAAYC,OAAZ,GAAsBC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB;AACtCC,QAAAA,aAAa,EAAEL;AADuB,OAAlB,EAEnBP,IAAI,CAACQ,MAAL,CAAYC,OAFO,CAAtB;AAGD,KALD;AAMD;AACF;;AAED,IAAMI,aAAa,GAAG,SAAhBA,aAAgB,CAACb,IAAD,EAAU;AAC9BA,EAAAA,IAAI,CAACQ,MAAL,CAAYC,OAAZ,GAAsBC,MAAM,CAACC,MAAP,CAAc,EAAd,sBACnBlB,gBAAgB,CAACqB,UADE,EACWvB,MAAM,GAAGwB,MAAT,CAAgB,kBAAhB,CADX,GAEnBf,IAAI,CAACQ,MAAL,CAAYC,OAFO,CAAtB;AAGD,CAJD;;AAMAf,cAAc,CAACsB,MAAf,CAAsBC,IAAtB,CAA2B,UAACC,OAAD,EAAa;AACtCA,EAAAA,OAAO,CAACC,MAAR,CAAepB,QAAf;AACAmB,EAAAA,OAAO,CAACC,MAAR,CAAeN,aAAf;AACD,CAHD;AAKA,OAAO,IAAMO,QAAQ,GAAG,SAAXA,QAAW;AAAA,SAAM1B,cAAc,CAACU,QAAf,CAAwBC,MAAxB,EAAN;AAAA,CAAjB;AACP,OAAO,IAAMgB,kBAAkB,GAAG,SAArBA,kBAAqB,CAACZ,OAAD,EAAa;AAC7C,2BACKA,OADL,sBAEGhB,gBAAgB,CAACqB,UAFpB,EAEiCvB,MAAM,GAAGwB,MAAT,CAAgB,kBAAhB,CAFjC;AAID,CALM;AAMP,eAAerB,cAAf","sourcesContent":["import feathers from 'feathers/client';\nimport rest from 'feathers-rest/client';\nimport axios from 'axios';\nimport hooks from 'feathers-hooks';\nimport auth from 'feathers-authentication-client';\nimport moment from 'moment';\nimport {\n  API_PREFIX,\n  HEADER_CONSTANTS,\n} from '../constants/General';\n\nconst feathersClient = feathers();\n\nfeathersClient\n.configure(hooks())\n.configure(rest('http://localhost:9000')\n.axios(axios))\n.configure(auth({\n  storage: window.localStorage,\n}));\n\nfunction authHook(hook) {\n  let index = (`/${hook.path}`).indexOf(API_PREFIX);\n  if (index !== -1) {\n    feathersClient.passport.getJWT()\n    .then((accessToken) => {\n      hook.params.headers = Object.assign({}, {\n        Authorization: accessToken,\n      }, hook.params.headers);\n    });\n  }\n}\n\nconst localTimeHook = (hook) => {\n  hook.params.headers = Object.assign({}, {\n    [HEADER_CONSTANTS.LOCAL_TIME]: moment().format('YYYY-MM-DD HH:mm'),\n  }, hook.params.headers);\n};\n\nfeathersClient.mixins.push((service) => {\n  service.before(authHook);\n  service.before(localTimeHook);\n});\n\nexport const getToken = () => feathersClient.passport.getJWT();\nexport const addLocalTimeHeader = (headers) => {\n  return {\n    ...headers,\n    [HEADER_CONSTANTS.LOCAL_TIME]: moment().format('YYYY-MM-DD HH:mm'),\n  };\n};\nexport default feathersClient;\n"]},"metadata":{},"sourceType":"module"}